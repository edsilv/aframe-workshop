<html>
  <head>
    <title>A-Frame Workshop</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/ar.js@1.7.1/aframe/build/aframe-ar.min.js"></script>
		<script src="/assets/components/aframe-google-poly-component.js"></script>
		<script src="/assets/scripts/google-poly.js"></script>
  </head>

  <body style="margin: 0px; overflow: hidden;">

		<script>
			poly.api_key = "AIzaSyBCQ44lFHGHgkLkaLlpW5-sreHGLOASWds";
      poly.listAssetsByUser();
      //poly.search("animals", "lion");
    </script>
    
    <script>
        var YOUR_CLIENT_ID = 'REPLACE_THIS_VALUE';
        var YOUR_REDIRECT_URI = 'REPLACE_THIS_VALUE';
        var fragmentString = location.hash.substring(1);
      
        // Parse query string to see if page request is coming from OAuth 2.0 server.
        var params = {};
        var regex = /([^&=]+)=([^&]*)/g, m;
        while (m = regex.exec(fragmentString)) {
          params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }
        if (Object.keys(params).length > 0) {
          localStorage.setItem('oauth2-test-params', JSON.stringify(params) );
          if (params['state'] && params['state'] == 'try_sample_request') {
            trySampleRequest();
          }
        }
      
        // If there's an access token, try an API request.
        // Otherwise, start OAuth 2.0 flow.
        function trySampleRequest() {
          var params = JSON.parse(localStorage.getItem('oauth2-test-params'));
          if (params && params['access_token']) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET',
                'https://www.googleapis.com/drive/v3/about?fields=user&' +
                'access_token=' + params['access_token']);
            xhr.onreadystatechange = function (e) {
              if (xhr.readyState === 4 && xhr.status === 200) {
                console.log(xhr.response);
              } else if (xhr.readyState === 4 && xhr.status === 401) {
                // Token invalid, so prompt for user permission.
                oauth2SignIn();
              }
            };
            xhr.send(null);
          } else {
            oauth2SignIn();
          }
        }
      
        /*
         * Create form to request access token from Google's OAuth 2.0 server.
         */
        function oauth2SignIn() {
          // Google's OAuth 2.0 endpoint for requesting an access token
          var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';
      
          // Create element to open OAuth 2.0 endpoint in new window.
          var form = document.createElement('form');
          form.setAttribute('method', 'GET'); // Send as a GET request.
          form.setAttribute('action', oauth2Endpoint);
      
          // Parameters to pass to OAuth 2.0 endpoint.
          var params = {'client_id': '73294129455-t8b2m6m33eoqg85mtrhpom44lqr4vo24.apps.googleusercontent.com',
                        'redirect_uri': window.location.href,
                        'scope': 'https://www.googleapis.com/auth/drive.metadata.readonly',
                        'state': 'try_sample_request',
                        'include_granted_scopes': 'true',
                        'response_type': 'token'};
      
          // Add form parameters as hidden input values.
          for (var p in params) {
            var input = document.createElement('input');
            input.setAttribute('type', 'hidden');
            input.setAttribute('name', p);
            input.setAttribute('value', params[p]);
            form.appendChild(input);
          }
      
          // Add form to page and submit it to open the OAuth 2.0 endpoint.
          document.body.appendChild(form);
          form.submit();
        }
      </script>
      
      <button onclick="trySampleRequest();">Try sample request</button>

    <!--
    <script>
        var GoogleAuth;
        var SCOPE = 'https://www.googleapis.com/auth/drive.metadata.readonly';
        function handleClientLoad() {
          // Load the API's client and auth2 modules.
          // Call the initClient function after the modules load.
          gapi.load('client:auth2', initClient);
        }
      
        function initClient() {
          // Retrieve the discovery document for version 3 of Google Drive API.
          // In practice, your app can retrieve one or more discovery documents.
          var discoveryUrl = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
      
          // Initialize the gapi.client object, which app uses to make API requests.
          // Get API key and client ID from API Console.
          // 'scope' field specifies space-delimited list of access scopes.
          gapi.client.init({
              'apiKey': 'AIzaSyBCQ44lFHGHgkLkaLlpW5-sreHGLOASWds',
              'discoveryDocs': [discoveryUrl],
              'clientId': '73294129455-t8b2m6m33eoqg85mtrhpom44lqr4vo24.apps.googleusercontent.com',
              'scope': SCOPE
          }).then(function () {
            GoogleAuth = gapi.auth2.getAuthInstance();
      
            // Listen for sign-in state changes.
            GoogleAuth.isSignedIn.listen(updateSigninStatus);
      
            // Handle initial sign-in state. (Determine if user is already signed in.)
            var user = GoogleAuth.currentUser.get();
            setSigninStatus();
      
            // Call handleAuthClick function when user clicks on
            //      "Sign In/Authorize" button.
            $('#sign-in-or-out-button').click(function() {
              handleAuthClick();
            }); 
            $('#revoke-access-button').click(function() {
              revokeAccess();
            }); 
          });
        }
      
        function handleAuthClick() {
          if (GoogleAuth.isSignedIn.get()) {
            // User is authorized and has clicked 'Sign out' button.
            GoogleAuth.signOut();
          } else {
            // User is not signed in. Start Google auth flow.
            GoogleAuth.signIn();
          }
        }
      
        function revokeAccess() {
          GoogleAuth.disconnect();
        }
      
        function setSigninStatus(isSignedIn) {
          var user = GoogleAuth.currentUser.get();
          var isAuthorized = user.hasGrantedScopes(SCOPE);
          if (isAuthorized) {
            $('#sign-in-or-out-button').html('Sign out');
            $('#revoke-access-button').css('display', 'inline-block');
            $('#auth-status').html('You are currently signed in and have granted ' +
                'access to this app.');
          } else {
            $('#sign-in-or-out-button').html('Sign In/Authorize');
            $('#revoke-access-button').css('display', 'none');
            $('#auth-status').html('You have not authorized this app or you are ' +
                'signed out.');
          }
        }
      
        function updateSigninStatus(isSignedIn) {
          setSigninStatus();
        }
      </script>
      
      <button id="sign-in-or-out-button"
              style="margin-left: 25px">Sign In/Authorize</button>
      <button id="revoke-access-button"
              style="display: none; margin-left: 25px">Revoke access</button>
      
      <div id="auth-status" style="display: inline; padding-left: 25px"></div><hr>
      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <script async defer src="https://apis.google.com/js/api.js" 
              onload="this.onload=function(){};handleClientLoad()" 
              onreadystatechange="if (this.readyState === 'complete') this.onload()">
      </script>
    -->
  </body>
</html>
